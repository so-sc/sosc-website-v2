---
// Imports
import Layout from "@/layouts/Layout.astro";
import MarkdownLayout from "@/layouts/MarkdownLayout.astro";
import { Image } from "astro:assets";
import { getCollection, render } from "astro:content";
import slugify from "slugify";

export async function getStaticPaths() {
  const events = await getCollection("events");
  return events.map((event) => ({
    params: { slug: slugify(event.data.name, { lower: true, strict: true }) },
    props: { event },
  }));
}

const { event } = Astro.props;
const { Content } = await render(event);
const { name, date, location, cover } = event.data;
const formattedDate = new Date(date).toLocaleDateString("en-US", {
  year: "numeric",
  month: "long",
  day: "numeric",
});
---

<Layout>
  <main class="mx-auto max-w-4xl space-y-10 px-4 py-20">
    <!-- Event Title & Info -->
    <div class="space-y-4">
      <p class="text-primary">{location}</p>
      <h1 class="text-4xl font-bold">{name}</h1>
      <p class="text-muted-foreground text-sm">{formattedDate}</p>

      <div class="border-primary my-2 w-20 rounded-2xl border-4 border-b"></div>

      <!-- Event Banner -->
      {
        cover && (
          <Image
            src={cover}
            alt={name}
            class="h-auto w-full object-contain bg-gray-100"
            loading={"eager"}
            format="webp"
            quality={80}
          />
        )
      }
    </div>

    <!-- Markdown Content -->
    <MarkdownLayout>
      <Content />
    </MarkdownLayout>
  </main>
</Layout>

<style>
  /* Override prose styles for better heading spacing */
  :global(.prose h1) {
    margin-top: 2rem;
    margin-bottom: 0.5rem;
  }

  :global(.prose h2) {
    margin-top: 1.75rem;
    margin-bottom: 0.5rem;
  }

  :global(.prose h3) {
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
  }

  :global(.prose h4) {
    margin-top: 1.5rem;
    margin-bottom: 0.5rem;
  }

  :global(.prose h5) {
    margin-top: 1.25rem;
    margin-bottom: 0.5rem;
  }

  :global(.prose h6) {
    margin-top: 1.25rem;
    margin-bottom: 0.5rem;
  }

  :global(.prose p) {
    margin-top: 0.5rem;
    margin-bottom: 0.75rem;
  }

  :global(.prose hr) {
    margin-top: 0.5rem;
    margin-bottom: 0.5rem;
  }
</style>
