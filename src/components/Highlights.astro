---
import CommunityCard from './cards/CommunityCard.astro';

interface EventItem {
  title: string;
  category: string;
  date: string;
  image: string;
  shortDesc: string;
  fullDesc: string;
}

const events: EventItem[] = [
  {
    title: "DevHost 2025",
    category: "Flagship event",
    date: "Nov 2025",
    image: "/highlights/devhost.jpeg",
    shortDesc: "The annual convergence of code, culture, and community. A flagship gathering of minds.",
    fullDesc: "Devhost, the flagship event is a remarkable tech convergence, is set to be an exhilarating experience with an exciting mix of technical and non-technical events. It seeks to equip participants with knowledge and skills, while encouraging curiosity and fostering innovation. With a variety of tech and non-tech battles and events featuring dev talks and workshops led by industry experts"
  },
  {
    title: "HackHarbor 3.0",
    category: "Mentoring",
    date: "August 2025",
    image: "/highlights/hackharbor.jpeg",
    shortDesc: "A peer-to-peer learning program helping first-year students transition smoothly into their second year.",
    fullDesc: "HackHarbor is an SOSC-led peer-to-peer learning initiative created for first-year students preparing to enter their second year. The program focuses on strengthening fundamentals, exposing participants to real development workflows, and encouraging collaborative learning through guided sessions led by senior students. HackHarbor creates a supportive environment where juniors learn by building, asking questions freely, and growing alongside their peers."
  },
  {
    title: "SOSC Podcast",
    category: "Media",
    date: "",
    image: "/highlights/sosc-podcast.jpg",
    shortDesc: "Dive into the stories behind SOSC’s journey, challenges, and discussions with industry experts",
    fullDesc: "The SOSC Podcast brings listeners closer to the minds behind the community. Each episode features insightful conversations with founding members and industry experts, exploring technical journeys, leadership lessons, and the evolution of open-source initiatives. It’s a platform to understand how innovation, mentorship, and collaboration drive SOSC’s impact in the tech ecosystem."
  },
  {
    title: "Tech Week",
    category: "Technical Event",
    date: "March-April 2025",
    image: "/highlights/techweek.jpeg",
    shortDesc: "A week of sessions on trending tech topics and practical workflows.",
    fullDesc: "Tech Week, featured a series of sessions led by community members on topics like Serverless Unleashed, Tux101: Linux for Everyone, GCP Accelerate, Self-Hosting Essentials and GOFR workshop. Attendees gained hands-on experience, practical insights, and guidance on modern development practices. The event fostered collaboration, curiosity, and skill-building, highlighting SOSC’s role in promoting tech education and empowering students with open-source knowledge."
  },
  {
    title: "SOSC at IndiaFOSS",
    category: "Outreach",
    date: "Jan 2026",
    image: "/highlights/indiafoss.jpeg",
    shortDesc: "Showcasing SOSC at IndiaFOSS, engaging with attendees, and sharing open-source stories.",
    fullDesc: "SOSC participated in IndiaFOSS with an interactive booth, connecting with tech enthusiasts, students, and professionals. The team shared insights about community-driven projects, open-source initiatives, and ongoing programs, answering questions and inspiring attendees to contribute and collaborate. It was an opportunity to showcase SOSC’s impact, exchange ideas, and strengthen the community’s presence in the larger tech ecosystem."
  },
  {
    title: "Go and GoFr Workshop",
    category: "Workshop",
    date: "Apr 2025",
    image: "/highlights/go-gofr.jpeg",
    shortDesc: "Hands-on Go programming workshop by the GoFr team during Tech Week.",
    fullDesc: "The Go and GoFr Workshop, conducted by the GoFr team during SOSC’s Tech Week, introduced participants to Go programming fundamentals and practical applications. Attendees engaged in interactive sessions, coding exercises, and real-world problem solving, gaining insights into efficient development practices and modern software workflows. The workshop encouraged collaboration, experimentation, and skill-building for budding developers."
  },
  {
    title: "DevHack 2025",
    category: "Hackathon",
    date: "Nov 2025",
    image: "/highlights/DevHackFinal.png",
    shortDesc: "A 36-hour hackathon during DevHost 2025 with expert mentorship and guidance.",
    fullDesc: "DevHack 2025, a 36-hour hackathon held as part of DevHost, brought together students to build innovative projects. SOSC members organized the event with mentors, including professionals from EG, providing guidance, feedback, and technical insights. Participants collaborated intensely, learned from experts, and showcased their solutions, making it a platform for creativity, skill-building, and community-driven innovation."
  }
];
---

<section class="relative w-full bg-white py-12 md:py-24 overflow-hidden">
  <!-- Added: Subtle Grid Background -->
  <div class="absolute inset-0 pointer-events-none bg-[linear-gradient(to_right,#80808012_1px,transparent_1px),linear-gradient(to_bottom,#80808012_1px,transparent_1px)] bg-[size:24px_24px]"></div>

  <!-- Header -->
  <div class="container relative mx-auto mb-10 md:mb-16 px-4 md:px-6 z-10">
    <!-- Added: System Log -->
    <div class="mb-4 flex items-center gap-2 font-mono text-[10px] md:text-xs font-bold text-primary">
      <span class="animate-pulse">●</span>
      <span>SYSTEM_EVENTS_LOG</span>
    </div>

    <div class="flex flex-col items-start justify-between border-b border-gray-900 pb-6 md:pb-8 md:flex-row md:items-end">
      <div>
        <h2 class="text-4xl md:text-8xl font-black uppercase leading-none tracking-tighter text-gray-900">
          Community
          <span class="block text-2xl md:text-6xl text-primary mt-1 md:mt-0">Highlights</span>
        </h2>
      </div>
      <div class="mt-6 max-w-sm md:mt-0 md:text-right">
        <p class="font-bold uppercase tracking-widest text-gray-400 text-[10px] md:text-xs mb-1 md:mb-2">Since 2018</p>
        <p class="text-xs md:text-sm font-medium leading-relaxed text-gray-900">
          Our impact is measured in code deployed, skills learned, and connections made.
        </p>
      </div>
    </div>
  </div>

  <!-- Scroll Area -->
  <div class="relative w-full overflow-hidden border-b border-gray-100 pb-12 md:pb-24 z-10">
    <div class="flex w-max animate-marquee gap-6 md:gap-10 py-6 md:py-10 pl-4 md:pl-6 hover:pause">
      {[...events, ...events].map((event) => (
        <CommunityCard {...event} />
      ))}
    </div>
  </div>

  <!-- Modal -->
  <dialog 
  id="flat-modal"
  class="m-auto w-[95%] max-w-6xl bg-white p-0 shadow-[0_0_0_1px_rgba(0,0,0,0.1)] outline-none backdrop:bg-white/90 backdrop:backdrop-blur-sm z-50"
>
  <!-- Modal Container -->
  <div class="flex max-h-[85vh] flex-col md:flex-row overflow-hidden">
    
    <!-- Image Panel -->
    <div class="relative w-full md:w-1/2 bg-gray-100">
      <div class="relative h-56 md:h-full">
        <img
          id="modal-img"
          src=""
          alt=""
          class="absolute inset-0 h-full w-full object-cover"
        />

        <!-- Category Tag -->
        <span
          id="modal-category"
          class="absolute left-0 top-0 bg-red-600 px-3 py-1 text-[10px] md:text-xs font-bold uppercase tracking-widest text-white"
        >
          Category
        </span>
      </div>
    </div>

    <!-- Content Panel -->
    <div class="relative flex w-full md:w-1/2 flex-col">
      
      <!-- Close Button -->
      <button
        id="close-modal"
        class="absolute right-4 top-4 z-20 bg-gray-100 p-3 text-gray-900 transition-colors hover:bg-red-600 hover:text-white"
        aria-label="Close"
      >
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="square" stroke-linejoin="miter" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>

      <!-- Static Header -->
      <div class="shrink-0 border-b border-gray-100 px-6 pb-6 pt-10 md:px-12">
        <div class="mb-4 flex items-center gap-4">
          <span id="modal-date" class="font-mono text-[10px] md:text-xs font-bold text-gray-400">
            DATE
          </span>
          <span class="h-px w-8 bg-primary"></span>
        </div>

        <h3
          id="modal-title"
          class="text-2xl md:text-5xl font-black uppercase leading-tight text-gray-900"
        >
          Title
        </h3>
      </div>

      <!-- Scrollable Body -->
      <div class="flex-1 overflow-y-auto px-6 py-6 md:px-12 md:py-8">
        <p
          id="modal-desc"
          class="whitespace-pre-line text-sm md:text-lg font-light leading-relaxed text-gray-600"
        >
          Description text...
        </p>
      </div>
    </div>
  </div>
</dialog>

</section>

<style>
  /* Linear Infinite Scroll */
  @keyframes marquee {
    from { transform: translateX(0); }
    to { transform: translateX(-33.33%); }
  }
  
  .animate-marquee {
    animation: marquee 40s linear infinite;
  }
  
  @media (max-width: 768px) {
    .animate-marquee {
      animation-duration: 30s; 
    }
  }

  .hover\:pause:hover {
    animation-play-state: paused;
  }

  /* Modal Animation */
  dialog[open] {
    animation: fade-in 0.3s ease-out forwards;
  }

  @keyframes fade-in {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
  }

  /* Reset default dialog styles */
  dialog {
    border: none;
    margin: auto;
    position: fixed;
    inset: 0;
  }
  
  /* Ensure backdrop works nicely */
  dialog::backdrop {
    background: rgba(255, 255, 255, 0.8);
    backdrop-filter: blur(2px);
  }
</style>

<script>
  const dialog = document.getElementById('flat-modal') as HTMLDialogElement | null;
  const closeBtn = document.getElementById('close-modal');
  const cards = document.querySelectorAll('[data-community-card]');

  // Bindings
  const mTitle = document.getElementById('modal-title');
  const mCategory = document.getElementById('modal-category');
  const mImage = document.getElementById('modal-img') as HTMLImageElement | null;
  const mDate = document.getElementById('modal-date');
  const mDesc = document.getElementById('modal-desc');

  if (dialog) {
    cards.forEach(card => {
      card.addEventListener('click', () => {
        const data = (card as HTMLElement).dataset;
        
        if(mTitle) mTitle.textContent = data.title || '';
        if(mCategory) mCategory.textContent = data.category || '';
        if(mImage) mImage.src = data.image || '';
        if(mDate) mDate.textContent = data.date || '';
        if(mDesc) mDesc.textContent = data.desc || '';

        dialog.showModal();
        document.body.style.overflow = 'hidden';
      });
    });

    const close = () => {
      dialog.close();
      document.body.style.overflow = '';
    };

    if(closeBtn) closeBtn.addEventListener('click', close);
    
    dialog.addEventListener('click', (e) => {
      const rect = dialog.getBoundingClientRect();
      const isInDialog = (rect.top <= e.clientY && e.clientY <= rect.top + rect.height &&
        rect.left <= e.clientX && e.clientX <= rect.left + rect.width);
      if (!isInDialog) close();
    });
  }
</script>